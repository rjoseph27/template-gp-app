<form [formGroup]="reportTripForm" (ngSubmit)="submitForm()">
    <div class="group">
        <div class="section">
            <div class="sub-section">
                <gh-select-field
                [label]="'sendItems.location.from' | translate" 
                [placeholder]="'sendItems.location.country.placeholder' | translate"
                [name]="userCountryField"
                [value]="reportTripForm.get(userCountryField).value"
                (valueChange)="updateUserCountry($event)"
                [errors]="reportTripForm.get(userCountryField).errors"
                [errorCaptions]="countryErrorCaptions"
                [options]="userCountryOptions"
                [disabled]="reviseDate"
                [readonly]="currentFormMode === formMode.VIEW"
                ></gh-select-field>
            </div>
            <div class="sub-section">
                <gh-select-field
                [placeholder]="'reportTrip.airport.placeholder' | translate"
                [name]="userAirportField"
                [value]="reportTripForm.get(userAirportField).value"
                (valueChange)="reportTripForm.get(userAirportField).setValue($event)"
                [errors]="reportTripForm.get(userAirportField).errors"
                [errorCaptions]="airportErrorCaptions"
                [options]="userAirports$ | async"
                [disabled]="reviseDate"
                [readonly]="currentFormMode === formMode.VIEW"
                ></gh-select-field>
            </div>
        </div>
        <div class="section">
            <div class="sub-section">
                <gh-date-field
                [label]="'reportTrip.date.departure.label' | translate"
                [placeholder]="'reportTrip.date.departure.datePlaceholder' | translate" 
                [name]="departureDateField"
                [value]="reportTripForm.get(departureDateField).value"
                (valueChange)="reportTripForm.get(departureDateField).setValue($event)"
                [errors]="reportTripForm.get(departureDateField).errors"
                [minDate]="minDepartureDate"
                [errorCaptions]="dateErrorCaptions"
                [readonly]="currentFormMode === formMode.VIEW"
                ></gh-date-field>
            </div>
            <div class="sub-section">
                <gh-time-field
                [name]="departureTimeField"
                [placeholder]="'reportTrip.date.departure.timePlaceholder' | translate"
                [value]="reportTripForm.get(departureTimeField).value"
                (valueChange)="reportTripForm.get(departureTimeField).setValue($event)"
                [errors]="reportTripForm.get(departureTimeField).errors"
                [errorCaptions]="timeErrorCaptions"
                [readonly]="currentFormMode === formMode.VIEW"
                ></gh-time-field>
            </div>
        </div>
        <div class="section">
            <div class="sub-section">
                <gh-select-field
                [label]="'sendItems.location.to' | translate" 
                [placeholder]="'sendItems.location.country.placeholder' | translate"
                [name]="destinationCountryField"
                [value]="reportTripForm.get(destinationCountryField).value"
                (valueChange)="destinationUserCountry($event)"
                [errors]="reportTripForm.get(destinationCountryField).errors"
                [errorCaptions]="countryErrorCaptions"
                [options]="destinationCountryOptions$ | async"
                [disabled]="reviseDate"
                [readonly]="currentFormMode === formMode.VIEW"
                ></gh-select-field>
            </div>
            <div class="sub-section">
                <gh-select-field
                [placeholder]="'reportTrip.airport.placeholder' | translate"
                [name]="destinationAirportField"
                [value]="reportTripForm.get(destinationAirportField).value"
                (valueChange)="reportTripForm.get(destinationAirportField).setValue($event)"
                [errors]="reportTripForm.get(destinationAirportField).errors"
                [errorCaptions]="airportErrorCaptions"
                [options]="destinationAirports$ | async"
                [disabled]="reviseDate"
                [readonly]="currentFormMode === formMode.VIEW"
                ></gh-select-field>
            </div>
        </div>
        <div class="section">
            <div class="sub-section">
                <gh-date-field
                [label]="'reportTrip.date.arrival.label' | translate"
                [placeholder]="'reportTrip.date.arrival.datePlaceholder' | translate" 
                [name]="arrivalDateField"
                [value]="reportTripForm.get(arrivalDateField).value"
                (valueChange)="reportTripForm.get(arrivalDateField).setValue($event)"
                [errors]="reportTripForm.get(arrivalDateField).errors"
                [minDate]="minDepartureDate"
                [errorCaptions]="dateErrorCaptions"
                [readonly]="currentFormMode === formMode.VIEW"
                ></gh-date-field>
            </div>
            <div class="sub-section">
                <gh-time-field
                [name]="arrivalTimeField"
                [placeholder]="'reportTrip.date.arrival.timePlaceholder' | translate"
                [value]="reportTripForm.get(arrivalTimeField).value"
                (valueChange)="reportTripForm.get(arrivalTimeField).setValue($event)"
                [errors]="reportTripForm.get(arrivalTimeField).errors"
                [errorCaptions]="timeErrorCaptions"
                [readonly]="currentFormMode === formMode.VIEW"
                ></gh-time-field>
            </div>
        </div>
    </div>
    <hr class="gp-divider">
    <div class="group" *ngIf="!reviseDate">
        <div class="title">
            {{ 'reportTrip.pricingInformation.title' | translate }}
        </div>
        <div class="section">
            <gh-number-field
            [label]="'reportTrip.pricingInformation.availableSpace.label' | translate"
            [placeholder]="'reportTrip.pricingInformation.availableSpace.placeholder' | translate"
            [name]="availableSpaceField"
            [value]="reportTripForm.get(availableSpaceField).value"
            (valueChange)="reportTripForm.get(availableSpaceField).setValue($event)"
            [errors]="reportTripForm.get(availableSpaceField).errors"
            [errorCaptions]="availableSpaceErrorCaptions"
            [min]="0.5"
            [step]="0.5"
            [suffix]="'unit.kg' | translate"
            [readonly]="currentFormMode === formMode.VIEW"
           ></gh-number-field> 
        </div>
        <div class="section">
            <gh-number-field
            [label]="('reportTrip.pricingInformation.defaultPrice.label' | translate) + ' ('+ (userCurrency$ | async).currency + ')'"
            [placeholder]="'reportTrip.pricingInformation.defaultPrice.placeholder' | translate"
            [name]="defaultPriceField"
            [value]="reportTripForm.get(defaultPriceField).value"
            (valueChange)="reportTripForm.get(defaultPriceField).setValue($event)"
            [errors]="reportTripForm.get(defaultPriceField).errors"
            [errorCaptions]="defaultPriceErrorCaptions"
            [min]="0"
            [step]="(userCurrency$ | async)?.step"
            [readonly]="currentFormMode === formMode.VIEW"
            [suffix]="(userCurrency$ | async)?.currency"
           ></gh-number-field> 
        </div>
        <gh-table
            *ngIf="!reviseDate"
            [columns]="specificPriceTableColumns$ | async" 
            [(elements)]="specificPriceElements"
            [canAdd]="currentFormMode === formMode.CREATE" 
            [canDelete]="currentFormMode === formMode.CREATE" 
            [idProperty]="'id'" 
            [emptyTemplate]="emptyTemplate"
            [itemFactory]="newSpecificItemFactory"
            [deleteFactory]="deleteSpecificItemFactory"
            ></gh-table>
    </div>
</form>
<div>
    <button
        *ngIf="currentFormMode === formMode.CREATE"
        [buttonLoading]="loading$ | async" 
        type="submit" 
        class="gp-button" 
        [disabled]="!reportTripForm.valid"
        (click)="submitForm()"
    >{{ 'moduleList.gp.reportTrip.send' | translate }}</button>
</div>
<ng-template #emptyTemplate let-value="value">
    <div class="empty-view">
        <div class="empty-content">
            <gh-icon [name]="emptyTableLogo"></gh-icon>
            <div class="empty-caption">{{ 'reportTrip.pricingInformation.specificPrice.table.empty' | translate }}</div>
        </div>
    </div>
</ng-template>

<ng-template #categoryTemplate let-element="element">
    <gh-selection-tree 
        [placeholder]="'global.itemInformation.itemCategory.placeholder' | translate"
        [name]="element.id"
        [value]="specificPriceFormControl.at(element.id).get('category').value"
        (valueChange)="specificPriceFormControl.at(element.id).get('category').setValue($event)"
        [errors]="specificPriceFormControl.at(element.id).get('category').errors"
        [errorCaptions]="itemCategoryErrorCaptions"
        [readonly]="currentFormMode === formMode.VIEW"
    ></gh-selection-tree>

</ng-template>

<ng-template #priceTemplate let-element="element">
    <gh-number-field
        [placeholder]="'reportTrip.pricingInformation.specificPrice.table.price.placeholder' | translate"
        [name]="element.id"
        [value]="specificPriceFormControl.at(element.id).get('price').value"
        (valueChange)="specificPriceFormControl.at(element.id).get('price').setValue($event)"
        [errors]="specificPriceFormControl.at(element.id).get('price').errors"
        [errorCaptions]="specificPriceErrorCaptions"
        [min]="0"
        [step]="(userCurrency$ | async)?.step"
        [suffix]="(userCurrency$ | async)?.currency"
        [readonly]="currentFormMode === formMode.VIEW"
    ></gh-number-field>
</ng-template>

<ng-template #unitTemplate let-element="element">
    <gh-select-field
        [placeholder]="'global.itemInformation.itemCategory.placeholder' | translate"
        [name]="element.id"
        [value]="specificPriceFormControl.at(element.id).get('unit').value"
        (valueChange)="specificPriceFormControl.at(element.id).get('unit').setValue($event)"
        [errors]="specificPriceFormControl.at(element.id).get('unit').errors"
        [errorCaptions]="itemCategoryErrorCaptions"
        [options]="unitOptions"
        [readonly]="currentFormMode === formMode.VIEW"
    ></gh-select-field>
</ng-template>